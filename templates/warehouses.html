<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <title>Ambarlar</title>
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background: #f9fafb;
      margin: 0;
      padding: 20px;
    }

    h2 {
      color: #222;
      margin-bottom: 20px;
    }

    .container {
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
    }

    .card {
      background: white;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.06);
      width: 300px;
      transition: 0.2s;
      cursor: default;
      position: relative;
    }

    .card:hover {
      transform: scale(1.03);
    }

    .card-title {
      font-size: 18px;
      font-weight: bold;
      color: #3b82f6;
      margin-bottom: 10px;
    }

    .card-info {
      font-size: 14px;
      color: #555;
      line-height: 1.4;
    }

    .context-menu {
      position: absolute;
      background: white;
      border: 1px solid #ccc;
      border-radius: 6px;
      list-style: none;
      padding: 5px 0;
      margin: 0;
      box-shadow: 0 2px 6px rgba(0,0,0,0.15);
      z-index: 999;
    }

    .context-menu li {
      padding: 8px 16px;
      cursor: pointer;
    }

    .context-menu li:hover {
      background-color: #f0f0f0;
    }
  </style>
</head>
<body>
  <h2>📦 Ambarlar</h2>
  <div class="container" id="warehouseList"></div>
  <ul id="contextMenu" class="context-menu" style="display:none;"></ul>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import {
      getFirestore,
      collection,
      addDoc,
      getDocs,
      updateDoc,
      doc
    } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyD4MPM2fvkTXeOWG12g-wV_s3eG4SkBWS0",
      authDomain: "poleroyuncak.firebaseapp.com",
      projectId: "poleroyuncak",
      storageBucket: "poleroyuncak.firebasestorage.app",
      messagingSenderId: "473844630811",
      appId: "1:473844630811:web:bd89bb7d85c7b17ea03fbe",
      measurementId: "G-CV6WKBTJ3V"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const listEl = document.getElementById("warehouseList");
    const contextMenu = document.getElementById("contextMenu");

    let currentRightClicked = null;

    async function loadWarehouses() {
      listEl.innerHTML = "";
      const snapshot = await getDocs(collection(db, "warehouses"));
      snapshot.forEach((docSnap) => {
        const data = docSnap.data();
        const card = document.createElement("div");
        card.className = "card";
        card.dataset.id = docSnap.id;
        card.dataset.raw = JSON.stringify(data);

        card.innerHTML = `
          <div class="card-title">${data.name}</div>
          <div class="card-info">
            📍 ${data.address || "-"}<br>
            👤 ${data.person || "-"}<br>
            📞 ${data.phone || "-"}
          </div>
        `;

        listEl.appendChild(card);
      });
    }

    document.body.addEventListener("contextmenu", function (e) {
      e.preventDefault();
      contextMenu.innerHTML = "";

      const card = e.target.closest(".card");
      currentRightClicked = card;

      if (card) {
        const edit = document.createElement("li");
        edit.textContent = "Ambarı Düzenle";
        edit.onclick = () => editWarehouse(JSON.parse(card.dataset.raw), card.dataset.id);
        contextMenu.appendChild(edit);
      } else {
        const add = document.createElement("li");
        add.textContent = "Ambar Ekle";
        add.onclick = addWarehouse;
        contextMenu.appendChild(add);
      }

      contextMenu.style.top = `${e.pageY}px`;
      contextMenu.style.left = `${e.pageX}px`;
      contextMenu.style.display = "block";
    });

    document.addEventListener("click", () => {
      contextMenu.style.display = "none";
    });

    async function addWarehouse() {
      const name = prompt("Ambar Adı:");
      const address = prompt("Açık Adresi:");
      const person = prompt("İlgili Personel:");
      const phone = prompt("Telefon Numarası:");
      if (!name) return;

      await addDoc(collection(db, "warehouses"), {
        name,
        address,
        person,
        phone
      });

      loadWarehouses();
    }

    async function editWarehouse(data, id) {
      const name = prompt("Ambar Adı:", data.name);
      const address = prompt("Açık Adresi:", data.address);
      const person = prompt("Personel:", data.person);
      const phone = prompt("Telefon:", data.phone);
      if (!name) return;

      await updateDoc(doc(db, "warehouses", id), {
        name,
        address,
        person,
        phone
      });

      loadWarehouses();
    }

    loadWarehouses();
  </script>
</body>
</html>
