<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <title>üìä Stok & Malzeme Takip</title>
  <style>
    body { margin:0; font-family:Arial, sans-serif; background:#f5f6fa; color:#2c3e50; }
    header { background:#2c3e50; color:white; padding:15px 20px; font-size:20px; font-weight:bold; }
    #sidebar { width:220px; background:#34495e; position:fixed; top:50px; bottom:0; left:0; color:white; padding-top:20px; }
    #sidebar a { display:block; color:white; padding:12px 20px; text-decoration:none; cursor:pointer; }
    #sidebar a:hover { background:#3d566e; }
    #content { margin-left:240px; padding:20px; }
    h1 { margin-top:0; }
    .material-card { background:white; padding:15px; margin-bottom:12px; border-radius:8px;
      box-shadow:0 1px 3px rgba(0,0,0,0.1); display:flex; justify-content:space-between; align-items:center; }
    .material-card span { font-weight:bold; }
    .actions button { margin-left:5px; }
    /* Modal */
    #overlay { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); }
    #modal { display:none; position:fixed; top:50%; left:50%; transform:translate(-50%,-50%);
      background:white; padding:20px; border-radius:8px; box-shadow:0 0 15px rgba(0,0,0,0.3); width:300px; }
    #modal input { width:100%; margin:5px 0; padding:8px; }
  </style>
</head>
<body>
  <header>üì¶ Logo Tarzƒ± Muhasebe / Stok Programƒ±</header>
  <div id="sidebar">
    <a data-page="home">üè† Anasayfa</a>
    <a data-page="materials">üì¶ Malzemeler</a>
    <a data-page="warehouses">üè≠ Depolar</a>
    <a data-page="transfers">üîÑ Transferler</a>
    <a data-page="settings">‚öôÔ∏è Ayarlar</a>
  </div>
  <div id="content"></div>

  <!-- Modal for Add/Edit Material -->
  <div id="overlay"></div>
  <div id="modal">
    <h3 id="modal-title">Yeni Malzeme</h3>
    <input id="mat-name" placeholder="Ad">
    <input id="mat-code" placeholder="Kod">
    <input id="mat-unit" placeholder="Birim (adet, kg...)">
    <input id="mat-qty" type="number" placeholder="Miktar">
    <button id="saveMatBtn">Kaydet</button>
    <button onclick="closeModal()">Kapat</button>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getFirestore, collection, getDocs, addDoc, doc, updateDoc, deleteDoc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyD4MPM2fvkTXeOWG12g-wV_s3eG4SkBWS0",
      authDomain: "poleroyuncak.firebaseapp.com",
      projectId: "poleroyuncak",
      storageBucket: "poleroyuncak.firebasestorage.app",
      messagingSenderId: "473844630811",
      appId: "1:473844630811:web:bd89bb7d85c7b17ea03fbe",
      measurementId: "G-CV6WKBTJ3V"
    };
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    let editingId = null; // d√ºzenleme i√ßin id saklama

    function openModal(edit=false, material={}) {
      document.getElementById("overlay").style.display="block";
      document.getElementById("modal").style.display="block";
      document.getElementById("modal-title").textContent = edit ? "Malzeme D√ºzenle" : "Yeni Malzeme";
      document.getElementById("mat-name").value = material.name || "";
      document.getElementById("mat-code").value = material.stock_code || "";
      document.getElementById("mat-unit").value = material.unit || "";
      document.getElementById("mat-qty").value = material.stock_amount || "";
      editingId = edit ? material.id : null;
    }
    function closeModal(){
      document.getElementById("overlay").style.display="none";
      document.getElementById("modal").style.display="none";
    }

    async function saveMaterial(){
      const name=document.getElementById("mat-name").value;
      const code=document.getElementById("mat-code").value;
      const unit=document.getElementById("mat-unit").value;
      const qty=Number(document.getElementById("mat-qty").value);
      if(editingId){
        await updateDoc(doc(db,"materials",editingId),{name,stock_code:code,unit,stock_amount:qty});
      }else{
        await addDoc(collection(db,"materials"),{name,stock_code:code,unit,stock_amount:qty});
      }
      closeModal(); showPage("materials");
    }

    async function deleteMaterial(id){
      if(confirm("Silmek istediƒüine emin misin?")){
        await deleteDoc(doc(db,"materials",id));
        showPage("materials");
      }
    }

    async function showPage(page){
      const content=document.getElementById("content");
      if(page==="home"){
        content.innerHTML="<h1>üè† Anasayfa</h1><p>Ho≈ü geldiniz!</p>";
      }
      else if(page==="materials"){
        content.innerHTML="<h1>üì¶ Malzeme Listesi</h1><button onclick='openModal()'>‚ûï Yeni Malzeme</button><div id='materialList'>‚è≥</div>";
        const list=document.getElementById("materialList");
        const snapshot=await getDocs(collection(db,"materials"));
        list.innerHTML="";
        snapshot.forEach(docSnap=>{
          const m=docSnap.data();
          const div=document.createElement("div");
          div.className="material-card";
          div.innerHTML=`<span>${m.name} (${m.stock_code})</span>
                          <span>${m.stock_amount} ${m.unit}</span>
                          <span class='actions'>
                            <button onclick='openModal(true,{id:"${docSnap.id}",...${JSON.stringify(m)}})'>‚úèÔ∏è</button>
                            <button onclick='deleteMaterial("${docSnap.id}")'>üóëÔ∏è</button>
                          </span>`;
          list.appendChild(div);
        });
      }
      else if(page==="warehouses"){
        content.innerHTML="<h1>üè≠ Depolar</h1><div id='warehouseList'>‚è≥</div>";
        const list=document.getElementById("warehouseList");
        const snapshot=await getDocs(collection(db,"warehouses"));
        list.innerHTML="";
        snapshot.forEach(docSnap=>{
          const w=docSnap.data();
          const div=document.createElement("div");
          div.className="material-card";
          div.innerHTML=`<span>${w.name}</span>`;
          list.appendChild(div);
        });
      }
      else if(page==="transfers"){
        content.innerHTML="<h1>üîÑ Transferler</h1><p>Yakƒ±nda...</p>";
      }
      else if(page==="settings"){
        content.innerHTML="<h1>‚öôÔ∏è Ayarlar</h1><p>Yakƒ±nda...</p>";
      }
    }

    // event listeners
    document.querySelectorAll("#sidebar a").forEach(link=>{
      link.addEventListener("click",()=>showPage(link.dataset.page));
    });
    document.getElementById("saveMatBtn").addEventListener("click",saveMaterial);

    showPage("home"); // ba≈ülangƒ±√ß
    window.openModal=openModal; window.deleteMaterial=deleteMaterial;
  </script>
</body>
</html>
