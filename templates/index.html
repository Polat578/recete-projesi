<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <title>📊 Stok & Malzeme Takip</title>
  <style>
    body { margin:0; font-family:Arial, sans-serif; background:#f5f6fa; color:#2c3e50; }
    header { background:#2c3e50; color:white; padding:15px 20px; font-size:20px; font-weight:bold; }
    #sidebar { width:220px; background:#34495e; position:fixed; top:50px; bottom:0; left:0; color:white; padding-top:20px; }
    #sidebar a { display:block; color:white; padding:12px 20px; text-decoration:none; cursor:pointer; }
    #sidebar a:hover { background:#3d566e; }
    #content { margin-left:240px; padding:20px; }
    h1 { margin-top:0; }
    .card { background:white; padding:15px; margin-bottom:12px; border-radius:8px;
      box-shadow:0 1px 3px rgba(0,0,0,0.1); cursor:context-menu; }
    .card span { font-weight:bold; }
    /* context menu */
    #context-menu { position:absolute; z-index:1000; display:none; background:white; border:1px solid #ccc; border-radius:5px; list-style:none; padding:5px 0; }
    #context-menu li { padding:8px 16px; cursor:pointer; }
    #context-menu li:hover { background:#eee; }
    /* modal */
    #overlay { display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); }
    #modal { display:none; position:fixed; top:50%; left:50%; transform:translate(-50%,-50%);
      background:white; padding:20px; border-radius:8px; box-shadow:0 0 15px rgba(0,0,0,0.3); width:300px; }
    #modal input { width:100%; margin:5px 0; padding:8px; }
  </style>
</head>
<body>
  <header>📦 Odoo Tarzı Stok Programı</header>
  <div id="sidebar">
    <a data-page="materials">📦 Malzemeler</a>
    <a data-page="warehouses">🏭 Depolar</a>
  </div>
  <div id="content"></div>

  <!-- Context Menu -->
  <ul id="context-menu">
    <li id="ctx-add">➕ Ekle</li>
    <li id="ctx-edit">✏️ Düzenle</li>
    <li id="ctx-delete">🗑️ Sil</li>
  </ul>

  <!-- Modal -->
  <div id="overlay"></div>
  <div id="modal">
    <h3 id="modal-title">Yeni Kayıt</h3>
    <input id="item-name" placeholder="Ad">
    <input id="item-code" placeholder="Kod">
    <input id="item-unit" placeholder="Birim">
    <input id="item-qty" type="number" placeholder="Miktar">
    <button id="saveBtn">Kaydet</button>
    <button onclick="closeModal()">Kapat</button>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getFirestore, collection, getDocs, addDoc, updateDoc, deleteDoc, doc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyD4MPM2fvkTXeOWG12g-wV_s3eG4SkBWS0",
      authDomain: "poleroyuncak.firebaseapp.com",
      projectId: "poleroyuncak",
      storageBucket: "poleroyuncak.firebasestorage.app",
      messagingSenderId: "473844630811",
      appId: "1:473844630811:web:bd89bb7d85c7b17ea03fbe"
    };
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const contextMenu = document.getElementById("context-menu");
    const overlay = document.getElementById("overlay");
    const modal = document.getElementById("modal");
    let currentPage = "materials";
    let currentId = null;

    // modal
    function openModal(edit=false, data={}) {
      overlay.style.display="block";
      modal.style.display="block";
      document.getElementById("modal-title").textContent = edit ? "Düzenle" : "Yeni Kayıt";
      document.getElementById("item-name").value = data.name || "";
      document.getElementById("item-code").value = data.stock_code || "";
      document.getElementById("item-unit").value = data.unit || "";
      document.getElementById("item-qty").value = data.stock_amount || "";
      currentId = edit ? data.id : null;
    }
    window.closeModal = function(){ overlay.style.display="none"; modal.style.display="none"; }

    // context menu
    document.addEventListener("click",()=>contextMenu.style.display="none");
    document.addEventListener("contextmenu",(e)=>{
      const card = e.target.closest(".card");
      if(card){
        currentId = card.dataset.id;
        contextMenu.style.display="block";
        contextMenu.style.top = `${e.pageY}px`;
        contextMenu.style.left = `${e.pageX}px`;
        e.preventDefault();
      }
    });
    document.getElementById("ctx-add").onclick=()=>openModal();
    document.getElementById("ctx-edit").onclick=async ()=>{
      if(!currentId) return;
      const ref = doc(db,currentPage,currentId);
      const snap = await getDocs(collection(db,currentPage));
      snap.forEach(d=>{
        if(d.id===currentId) openModal(true,{id:d.id,...d.data()});
      });
    };
    document.getElementById("ctx-delete").onclick=async ()=>{
      if(currentId && confirm("Silinsin mi?")) {
        await deleteDoc(doc(db,currentPage,currentId));
        showPage(currentPage);
      }
    };

    // kayıt kaydet
    document.getElementById("saveBtn").onclick=async ()=>{
      const name=document.getElementById("item-name").value;
      const code=document.getElementById("item-code").value;
      const unit=document.getElementById("item-unit").value;
      const qty=Number(document.getElementById("item-qty").value);
      if(currentId){
        await updateDoc(doc(db,currentPage,currentId),{name,stock_code:code,unit,stock_amount:qty});
      } else {
        await addDoc(collection(db,currentPage),{name,stock_code:code,unit,stock_amount:qty});
      }
      closeModal(); showPage(currentPage);
    };

    async function showPage(page){
      currentPage = page;
      const content=document.getElementById("content");
      content.innerHTML=`<h1>${page==="materials"?"📦 Malzemeler":"🏭 Depolar"}</h1><div id='list'>⏳</div>`;
      const list=document.getElementById("list");
      const snapshot=await getDocs(collection(db,page));
      list.innerHTML="";
      snapshot.forEach(docSnap=>{
        const d=docSnap.data();
        const div=document.createElement("div");
        div.className="card";
        div.dataset.id=docSnap.id;
        div.innerHTML=`${d.name} ${d.stock_code?`(${d.stock_code})`:""} ${d.stock_amount?`- ${d.stock_amount} ${d.unit}`:""}`;
        list.appendChild(div);
      });
    }

    // sidebar navigation
    document.querySelectorAll("#sidebar a").forEach(a=>a.addEventListener("click",()=>showPage(a.dataset.page)));
    showPage("materials"); // default
  </script>
</body>
</html>
